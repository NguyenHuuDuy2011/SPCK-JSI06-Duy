<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý câu hỏi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../css/add.css">

</head>

<body>
    <a href="./admin.html"><button class="btn-back"><i class="fa-solid fa-arrow-left"></i> Về lại trang chủ - Admin</button></a>
    <div class="container">
        <p>Chọn khối lớp</p>
        <div id="grade-selection" class="grade-container">
            <select id="grade" onchange="selectGrade()">
                <option value="" selected disabled>Chọn khối</option>
                <option value="6">Lớp 6</option>
                <option value="7">Lớp 7</option>
                <option value="8">Lớp 8</option>
                <option value="9">Lớp 9</option>
            </select>
        </div>
        <div id="subject-selection" class="subject-container" style="display: none;">
            <p>Chọn môn học</p>
            <!-- <label for="subject">Chọn môn học:</label> -->
            <select id="subject" onchange="selectSubject()">
                <option value="" selected disabled>Chọn môn</option>
                <option value="math">Toán</option>
                <option value="history">Lịch sử - Địa lí</option>
                <option value="IT">Tin học</option>
                <option value="literature">Ngữ văn</option>
            </select>
        </div>
        
        <div id="question-form-container" style="display: none;">
            <!-- Form nhập câu hỏi -->
            <form id="question-form">
                <hr>
                <label for="question">Câu hỏi:</label>
                <input type="text" id="question" placeholder="Nhập câu hỏi" required>
        
                <label for="answers">Đáp án:</label>
                <div id="answers">
                    <input type="text" class="answer" placeholder="Đáp án 1" required>
                    <input type="text" class="answer" placeholder="Đáp án 2" required>
                    <input type="text" class="answer" placeholder="Đáp án 3" required>
                    <input type="text" class="answer" placeholder="Đáp án 4" required>
                </div>
        
                <label for="correct">Đáp án đúng (1-4):</label>
                <input type="number" id="correct" min="1" max="4" required placeholder="A-1, B-2, C-3, D-4">
        
                <button type="submit" class="btn">Thêm câu hỏi</button>
                <hr>
            </form>
        </div>
        
        <h2>Danh sách các câu hỏi</h2>
        <p id="subject-name"></p>
        <p id="total-questions">Tổng số câu hỏi: 0</p>
        <div id="question-list"></div>
    </div>

    <script>
        let selectedGrade = null;
            let selectedSubject = null;
            // Khi người dùng chọn khối lớp
            function selectGrade() {
                    const gradeSelect = document.getElementById("grade");
                    selectedGrade = gradeSelect.value;
                    console.log("Khối lớp được chọn:", selectedGrade);

                    if (selectedGrade) {
                        // Hiển thị phần chọn môn học
                        document.getElementById("subject-selection").style.display = "block";

                        // Ẩn form nhập câu hỏi và danh sách câu hỏi
                        document.getElementById("question-form-container").style.display = "none";
                        document.getElementById("question-list").innerHTML = "";

                        // Reset ô chọn môn về giá trị mặc định
                        const subjectSelect = document.getElementById("subject");
                        subjectSelect.value = ""; // Đặt lại giá trị của ô chọn môn
                    }
                }

                function selectSubject() {
                    const subjectSelect = document.getElementById("subject");
                    selectedSubject = subjectSelect.value;
                    console.log("Môn học được chọn:", selectedSubject);

                    if (selectedSubject) {
                        document.getElementById("question-form-container").style.display = "block";
                        renderQuestions();
                    }
                }
           

            // Thêm câu hỏi
            document.getElementById("question-form").addEventListener("submit", (e) => {
                    e.preventDefault();

                    const question = document.getElementById("question").value;
                    const answers = Array.from(document.querySelectorAll(".answer")).map(input => input.value);
                    const correct = parseInt(document.getElementById("correct").value) - 1;

                    if (correct < 0 || correct >= answers.length) {
                        alert("Đáp án đúng không hợp lệ!");
                        return;
                    }

                    const questionSets = JSON.parse(localStorage.getItem("questionSets")) || {};

                    // Đảm bảo tồn tại cấu trúc cho khối lớp và môn học
                    if (!questionSets[String(selectedGrade)]) {
                        questionSets[String(selectedGrade)] = {};
                    }
                    if (!questionSets[String(selectedGrade)][selectedSubject]) {
                        questionSets[String(selectedGrade)][selectedSubject] = [];
                    }

                    const editingIndex = document.getElementById("question-form").getAttribute("data-editing-index");
                    if (editingIndex !== null) {
                        // Cập nhật câu hỏi đã chỉnh sửa
                        questionSets[String(selectedGrade)][selectedSubject][editingIndex] = { question, answers, correct };
                        alert("Cập nhật câu hỏi thành công!");
                        document.getElementById("question-form").removeAttribute("data-editing-index");

                        // Đặt lại text trên nút thành "Thêm câu hỏi"
                        const submitButton = document.querySelector("#question-form button[type='submit']");
                        submitButton.textContent = "Thêm câu hỏi";
                    } else {
                        // Thêm câu hỏi mới
                        questionSets[String(selectedGrade)][selectedSubject].push({ question, answers, correct });
                        alert("Thêm câu hỏi thành công!");
                    }

                    // Lưu lại vào localStorage
                    localStorage.setItem("questionSets", JSON.stringify(questionSets));

                    document.getElementById("question-form").reset();
                    renderQuestions(); // Làm mới danh sách câu hỏi
                });
        // DOM element để hiển thị tên phân môn
            const subjectNameElement = document.getElementById("subject-name");
            const subjectSelect = document.getElementById("subject");

            // Hàm cập nhật tên phân môn
            function updateSubjectName() {
                const subject = subjectSelect.value; // Lấy giá trị môn học được chọn
                let subjectName = "";

                // Gán tên phân môn dựa trên giá trị
                switch (subject) {
                    case "math":
                        subjectName = "Toán";
                        break;
                    case "history":
                        subjectName = "Lịch sử - Địa lí";
                        break;
                    case "IT":
                        subjectName = "Tin học";
                        break;
                    case "literature":
                        subjectName = "Ngữ văn";
                        break;
                    default:
                        subjectName = "Chưa xác định";
                }

                // Cập nhật nội dung của phần tử
                subjectNameElement.innerText = `Khối lớp: ${selectedGrade || "Chưa xác định"} - Phân môn: ${subjectName}`;
            }

            // Gọi hàm cập nhật khi người dùng thay đổi môn học
            subjectSelect.addEventListener("change", () => {
                updateSubjectName();
                renderQuestions(); // Hiển thị danh sách câu hỏi tương ứng
            });

            // Gọi hàm cập nhật khi trang được tải
            updateSubjectName();
        // Lấy danh sách câu hỏi từ localStorage
        const questionSets = JSON.parse(localStorage.getItem("questionSets")) || {
            math: [],
            history: [],
            IT: [],
            literature: []
        };

        const form = document.getElementById("question-form");
        const questionInput = document.getElementById("question");
        const answersInputs = document.querySelectorAll(".answer");
        const correctInput = document.getElementById("correct");
        const questionList = document.getElementById("question-list");

        // Hiển thị danh sách câu hỏi
        function renderQuestions() {
                const questionSets = JSON.parse(localStorage.getItem("questionSets")) || {};
                console.log("Dữ liệu trong localStorage:", questionSets);

                // Chuyển đổi `selectedGrade` sang chuỗi để khớp với khóa trong `localStorage`
                const gradeKey = String(selectedGrade);
                const questions = questionSets[gradeKey]?.[selectedSubject] || [];
                console.log("Danh sách câu hỏi:", questions);

                const questionList = document.getElementById("question-list");
                const totalQuestionsElement = document.getElementById("total-questions");
                questionList.innerHTML = ""; // Xóa nội dung cũ

                if (!selectedGrade || !selectedSubject) {
                    totalQuestionsElement.innerText = "Tổng số câu hỏi: 0";
                    return; // Không làm gì nếu chưa chọn khối hoặc môn
                }

                if (questions.length === 0) {
                    questionList.innerHTML = "<h4>Phân môn này chưa có câu hỏi.</h4>";
                    totalQuestionsElement.innerText = "Tổng số câu hỏi: 0";
                    return;
                }

                // Hiển thị danh sách câu hỏi
                questions.forEach((q, index) => {
                    const questionDiv = document.createElement("div");
                    questionDiv.classList.add("question-item");
                    questionDiv.innerHTML = `
            <p><strong>Câu hỏi:</strong> ${q.question}</p>
            <ul>
                ${q.answers.map((a, i) => `<li>${i + 1}. ${a}</li>`).join("")}
            </ul>
            <p><strong>Đáp án đúng:</strong> ${q.correct + 1}</p>
            <button onclick="editQuestion(${index})">Sửa</button>
            <button onclick="deleteQuestion(${index})">Xóa</button>
        `;
                    questionList.appendChild(questionDiv);
                });

                // Cập nhật tổng số câu hỏi
                totalQuestionsElement.innerText = `Tổng số câu hỏi: ${questions.length}`;
            }

        // Thêm câu hỏi

        // Xóa câu hỏi
        function deleteQuestion(index) {
                const questionSets = JSON.parse(localStorage.getItem("questionSets")) || {};
                const questions = questionSets[selectedGrade]?.[selectedSubject] || [];

                if (confirm("Bạn có chắc chắn muốn xóa câu hỏi này?")) {
                    questions.splice(index, 1); // Xóa câu hỏi
                    questionSets[selectedGrade][selectedSubject] = questions; // Cập nhật danh sách
                    localStorage.setItem("questionSets", JSON.stringify(questionSets)); // Lưu lại vào localStorage
                    renderQuestions(); // Làm mới danh sách câu hỏi
                }
            }

        // Sửa câu hỏi
        // function editQuestion(subject, index) {
        //     const question = questionSets[subject][index];
        //     questionInput.value = question.question;
        //     answersInputs.forEach((input, i) => {
        //         input.value = question.answers[i] || "";
        //     });
        //     correctInput.value = question.correct + 1;
        //     subjectSelect.value = subject;

        //     // Xóa câu hỏi cũ sau khi sửa
        //     deleteQuestion(subject, index);
        // }

        // Sửa câu hỏi
        function editQuestion(index) {
                const questionSets = JSON.parse(localStorage.getItem("questionSets")) || {};
                const questions = questionSets[selectedGrade]?.[selectedSubject] || [];
                const question = questions[index];

                // Điền thông tin câu hỏi vào form
                document.getElementById("question").value = question.question;
                const answersInputs = document.querySelectorAll(".answer");
                answersInputs.forEach((input, i) => {
                    input.value = question.answers[i] || "";
                });
                document.getElementById("correct").value = question.correct + 1;

                // Lưu chỉ số câu hỏi đang được sửa
                document.getElementById("question-form").setAttribute("data-editing-index", index);

                // Thay đổi text trên nút thành "Sửa câu hỏi"
                const submitButton = document.querySelector("#question-form button[type='submit']");
                submitButton.textContent = "Sửa câu hỏi";
            }

        // Hiển thị câu hỏi ban đầu
        subjectSelect.addEventListener("change", renderQuestions);
        renderQuestions();
    </script>
</body>

</html>